---
draft: false
title: 「wifiには有効なip構成がありません」と言われてインターネットに繋らない
tags : ["Windows","インターネット 繋らない","DHCP","WiFiルーター"]
---
## 「wifiには有効なip構成がありません」を解決する方法
まず「有効なip構成がありません」のエラーはWindows系OSの特有のメッセージなので、このエラーに苦しめられている方のほとんどはWindowsユーザーとなります。
以下のフローの通りに試行すれば殆どの場合は解決するでしょう。

{{<mermaid align="left">}}
flowchart LR;
    A{有効なip構成がありません} --> B{1.ルーター再起動}
    A --> C{2.モデム再起動}
    A --> D{3.トラブルシューティングツール実行}
    B --> |成功| E[リフレッシュ]
    B --> |失敗| F[次へ]
    C --> |成功| G[リフレッシュ]
    C --> |失敗| H[次へ]
    D --> |成功| I[リフレッシュ]
    D --> |失敗| J[未解決]

{{< /mermaid >}}

### Windowsのトラブルシューティング
以下の手順で目的のトラブルシューティングを行います。
![トラブルシューティング1](../../images/windows_serch01.svg)
![トラブルシューティング2](../../images/windows_serch02.svg)
![トラブルシューティング3](../../images/windows_serch03.svg)
![トラブルシューティング4](../../images/windows_serch04.svg)
![トラブルシューティング5](../../images/windows_serch05.svg)

上記はWindows11の例ですがWindows10でもほぼ同じ操作で目的にたどり着きます。お試しください。



## 「有効なip構成がない」という状況を知りたい
「有効なip構成がない」＝有効なIPアドレスが取得出来ていない状況を示します。
IPアドレスはDHCPで取得するのが普通なので、DHCPがうまく機能していない可能性が高いです。

### グローバルIPアドレスは1つ
{{% notice note %}}
インターネットをするにはグローバルIPアドレスが必要です。これはインターネットの契約をした時にあなたのONUやモデム等に紐付けられている世界でたった1つのIPアドレスです。
{{% /notice %}}

{{% popup_left01 %}}
家の中でたった1つのIPアドレスで足りるなら良いのですが、普通はスマホやパソコンやTVもインターネットに接続しますし、スマホだって家族で3台とか5台必要な場合だってあります。そうするとIPアドレスがたくさん必要になります。こまった、、、、。
{{% /popup_left01 %}}

{{% popup_right02 %}}
それに自分のパソコンがグローバルIPアドレスでインターネットしていたら世界中のハッカーからパソコンの中身が丸見えになってしまいものすごく恐ろしいことになってしまいます。
{{% /popup_right02 %}}

### プライベートアドレスがたくさん必要になる
{{% notice tip %}}
グローバルIPアドレスは1つでそのアドレスでしかインターネットできないし、インターネット接続したい機器はたくさんあります。だから家の中（ローカルエリア）ではプライベートなIPアドレスを機器毎に割り当ててそのプライベートIPアドレスでインターネットする時は全て1つのグローバルIPアドレスに自動的に変換してアクセスする様な仕組みが利用されています（NATといいます）。{{% /notice %}}

{{% popup_left03 %}}
WiFiルーターはこういったNAT機能も装備しています。
{{% /popup_left03 %}}

#### DHCPは面倒からの解放
家の中で10個とかそれ以上のネットワーク機器を扱う場合は管理が大変です。プライベートIPアドレスの削除とか追加とかとても煩わしいです。その面倒から解放される為にDHCPが導入されました。DHCPは以下の要素を元に作られる仕組みになっています。

![wifiルーターでのDHCP構成サンプル](../../images/ruter_dhcp.svg)

上から「ステータス」のインターネット：IPアドレスはたった1つのグローバルIPアドレスです。

{{% notice note %}}
デフォルトゲートウエイは、ローカルネットワークとインターネットの出入口にあたります。
{{% /notice %}}

次にLAN側のMACアドレスはあなたのルーターにつけられた一意の識別番号です。

IPアドレスはローカルでの識別IPアドレスです。

{{% notice note %}}
サブネットマスクはざっくり言えば範囲指定です。IPV4（普通のIPアドレス採番体型）で枠の総数の例で言えば255.255.255.255が全部の枠を現しています。
{{% /notice %}}
サブネットマスクはローカルIPアドレスを取得したい数により変わります。
この例で言えば、192.168.0.1～192.168.0.254まで254個のローカルIPアドレスをDHCPで自動的に割り当てることができる設定になります。

{{% notice tip %}}
LANケーブルを繋ぐ、或いはWiFiならSSIDとパスワードが成功すれば、採番可能な範囲で自動的にIPアドレスを割り当てて貸し出してくれる仕組みをDHCPと言います。
{{% /notice %}}


## まとめ
 「wifiには有効なip構成がありません」のエラー表示は、DHCPだけでなく構成要素のデフォルトゲートウエイやサブネットマスク、あるいはローカルIPアドレスが変わってしまった場合などに表示される可能性があります。

ルーターを新しく買い換えた場合などもMACアドレスが変わったり、ネットワーク部のアドレスが変わることもあるので要注意です。それらを踏まえて冒頭で書いた解決方法のフローを試すのが問題解決の近道となります。
